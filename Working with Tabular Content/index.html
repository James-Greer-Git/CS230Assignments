<!--    Extra Credit Attempted: Highlight Data Row By Clicking Student Name,
        Delete Selected Data Row and Column
        Right Click Menu from cell, buttons to add row above or below
 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel = "stylesheet" href = "style.css">
    <title>Grade Sheet</title>
</head>
<body>
    <table id = "grades">
        <tr id = "headers">
            <th>Name</th>
            <th>ID</th>
            <th class = "header">Assignment 1</th>
            <th class = "header">Assignment 2</th>
            <th class = "header">Assignment 3</th>
            <th class = "header">Assignment 4</th>
            <th class = "header">Assignment 5</th>
            <th style = "cursor: pointer" onclick = "toggleAverage()">Average(%)</th>
        </tr>
        <tr>
            <td class = "student_name">Tianna Wall</div></td>
            <td>12345670</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_grade">0</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td class = "student_name">Anika Campos</div></td>
            <td>12345671</td>
            <td class = "assignment_grade">34</td>
            <td class = "assignment_grade">56</td>
            <td class = "assignment_grade">87</td>
            <td class = "assignment_grade">45</td>
            <td class = "assignment_grade">90</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td class = "student_name">Madalynn Bray</div></td>
            <td>12345672</td>
            <td class = "assignment_grade">23</td>
            <td class = "assignment_grade">56</td>
            <td class = "assignment_grade">76</td>
            <td class = "assignment_grade">87</td>
            <td class = "assignment_grade">32</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td class = "student_name">Rylee Nixon</div></td>
            <td>12345673</td>
            <td class = "assignment_grade">62</td>
            <td class = "assignment_grade">-</td>
            <td class = "assignment_grade">67</td>
            <td class = "assignment_grade">98</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td class = "student_name">Rowan Dawson</div></td>
            <td>12345674</td>
            <td class = "assignment_grade">76</td>
            <td class = "assignment_grade">54</td>
            <td class = "assignment_grade">23</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_grade">23</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td class = "student_name">Emma Smith</div></td>
            <td>12345675</td>
            <td class = "assignment_grade">98</td>
            <td class = "assignment_grade">100</td>
            <td class = "assignment_grade">78</td>
            <td class = "assignment_grade">76</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td class = "student_name">Julianne Boyer</div></td>
            <td>12345676</td>
            <td class = "assignment_grade">56</td>
            <td class = "assignment_grade">81</td>
            <td class = "assignment_grade">95</td>
            <td class = "assignment_grade">78</td>
            <td class = "assignment_grade">67</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td class = "student_name">David Harmon</div></td>
            <td>12345677</td>
            <td class = "assignment_grade">87</td>
            <td class = "assignment_grade">87</td>
            <td class = "assignment_grade">56</td>
            <td class = "assignment_grade">100</td>
            <td class = "assignment_grade">87</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td class = "student_name">Micheal Kerr</div></td>
            <td>12345678</td>
            <td class = "assignment_grade">76</td>
            <td class = "assignment_grade">98</td>
            <td class = "assignment_grade">78</td>
            <td class = "assignment_grade">78</td>
            <td class = "assignment_grade">70</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td class = "student_name">Aiden Calvin</div></td>
            <td>12345679</td>
            <td class = "assignment_grade">67</td>
            <td class = "assignment_grade">67</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_grade">98</td>
            <td class = "assignment_grade">98</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
    </table>
    <div id = "context-menu">
        <button class = "item" onclick = "insertRowAbove(0)">Insert Row Above</button>
        <button class = "item" onclick = "insertRowAbove(1)">Insert Row Below</button>
    </div>
    <p></p>
    <button onclick = "addRow(-1)">Add Row</button>
    <button onclick = "addColumn()">Add Column</button>
    <button onclick = "deleteElements()">Delete Highlighted Cells</button>
    <p></p>
    <div class = "table_info">
        <div style = "float: left">Unsubmitted Assignments:</div>
        <div id = "unsubmitted" style = "float: right"></div>
    </div>

    <script>
        //right click code found at https://itnext.io/how-to-create-a-custom-right-click-menu-with-javascript-9c368bb58724

        var table = document.getElementById("grades");
        var rows = table.getElementsByTagName("tr");
        var cells = table.getElementsByTagName("td");

        for(var i = 0; i < rows.length; i++){       //adding right click listener to show add row above/below selected cell
            rows[i].addEventListener("contextmenu", function(event){
            event.preventDefault();
            var contextElement = document.getElementById("context-menu");
            contextElement.style.top = event.pageY + "px";
            contextElement.style.left = event.pageX + "px";
            contextElement.classList.add("active");
                rowManipulation(this);              //this calls rowManipulation on the clicked row
            });
            window.addEventListener("click", function(){
            document.getElementById("context-menu").classList.remove("active");
            voidRowEdit();
            })
        }
        
        setInterval(function() {
            
            var table = document.getElementById("grades");
            var rows = table.getElementsByTagName("tr");
            //console.log(rows.length);
            var headers = table.getElementsByTagName("th");
            var cells = table.getElementsByTagName("td");
            //console.log(cells.length);
            var columns = cells.length/(rows.length - 1);
            //console.log(columns);
            var rowSum = 0;
            var unsubmitted = 0;
            var rowNum = 1;
            var columnIndex;

            for(var i = 2; i < headers.length - 1; i++){        //adding highlighting function to columns
                //console.log(headers.length);
                headers[i].onclick = function(){
                    let str = this.innerText;
                    str = str.slice(-1);
                    // var index = str.length();
                    index = parseInt(str) + 1;
                    for(var j = 0; j < rows.length; j++){
                        if(j === 0){
                            var cells = rows[j].getElementsByTagName("th");
                            var cell = cells[index];
                            if(cell.classList.contains("highlight")){
                            cell.classList.remove("highlight");
                            }
                            else{
                                cell.classList.add("highlight");
                                
                            }
                        }
                        else{
                            var cells = rows[j].getElementsByTagName("td");
                            var cell = cells[index];
                            if(cell.classList.contains("highlight")){
                            cell.classList.remove("highlight");
                            }
                            else{
                            cell.classList.add("highlight");
                            }
                        }
                    }
                }
            }

            for(var i = 0; i < cells.length; i++){      //adding highlighting function to rows
                if(i%columns === 0){
                    rowNum++;
                    cells[i].onclick = function(){
                        row = this.parentElement;
                        //console.log(row);
                        cells = row.getElementsByTagName("td");
                        //console.log(cells);
                        for(var j = 0; j < columns; j++){
                            if(cells[j].classList.contains("highlight")){
                                cells[j].classList.remove("highlight");
                                row.classList.remove("highlight");
                            }
                            else{
                                cells[j].classList.add("highlight");
                                row.classList.add("highlight");
                            }
                        }
                    }
                }
                if(i%columns > 1 && i%columns < columns - 1){          //Don't want the Name, ID or Average Cells to be editable              
                    if(cells[i].innerHTML === "-"){
                        unsubmitted++;
                        cells[i].style.backgroundColor = "yellow";
                    }
                    else{
                        //cells[i].style.backgroundColor = "inherit";
                    }
                    cells[i].onclick = function(){
                        if(this.hasAttribute("data-clicked")){
                            return;
                        }
                    this.setAttribute("data-clicked", "yes");
                    this.setAttribute("data-text", this.innerHTML);

                    var input = document.createElement("input");
                    input.setAttribute("type", "text");
                    input.value = this.innerHTML;
                    input.style.width = this.offsetWidth - (this.clientLeft * 2) + "px";
                    input.style.height = this.offsetHeight - (this.clientTop * 2) + "px";
                    input.style.border = "0px";
                    // input.style.fontFamily = "inherit";
                    // input.style.fontSize = "inherit";
                    // input.style.textAlign = "inherit";
                    input.style.backgroundColor = "LightGoldenRodYellow";

                    input.onblur = function(){
                        var td = input.parentElement;
                        var originalText = input.parentElement.getAttribute("data-text");
                        var currentText = this.value;


                        if(originalText != currentText){        //if the new input text is different from the previous text the new text will be displayed
                            //there are changes in the cell's text
                            td.removeAttribute("data-clicked");
                            td.removeAttribute("data-text");
                            td.innerHTML = currentText;
                            td.style.cssText = "padding 5px";
                            //console.log(originalText + " is changed to " + currentText);
                        }
                        else{
                            td.removeAttribute("data-clicked");
                            td.removeAttribute("data-text");
                            td.innerHTML = originalText;
                            td.style.cssText = "padding 5px";
                            //console.log("No changes made");
                        }
                    }

                    input.onkeypress = function(){  //user presses enter
                        if(event.keyCode == 13){
                            this.blur();
                        }
                    }

                    this.innerHTML = "";
                    this.style.cssText = "padding: 0px 0px";
                    this.append(input);
                    this.firstElementChild.select();
                    }
                    var value = cells[i].innerHTML;
                    
                    if(Number.isInteger(parseInt(value))){
                        if(value < 0 || value > 100){
                            cells[i].innerHTML = "-";
                        }
                        else{
                            rowSum += parseInt(value);
                        }
                    }
                    else if(value = "-"){
                        rowSum += 0;
                    }
                }
                else if(i%columns == columns - 1){
                    var finalGrade = parseInt(rowSum/(columns - 3));
                    //console.log(finalGrade);

                    if(cells[i].id === "percent_grade"){
                        //console.log(finalGrade);
                        cells[i].innerHTML = finalGrade + "%";
                    }
                    else if(cells[i].id === "letter_grade"){
                        if(finalGrade < 60){
                            cells[i].innerHTML = "F";
                        }
                        else if(finalGrade < 63){
                            cells[i].innerHTML = "D-";
                        }
                        else if(finalGrade < 67){
                            cells[i].innerHTML = "D";
                        }
                        else if(finalGrade < 70){
                            cells[i].innerHTML = "D+";
                        }
                        else if(finalGrade < 73){
                            cells[i].innerHTML = "C-";
                        }
                        else if(finalGrade < 77){
                            cells[i].innerHTML = "C";
                        }
                        else if(finalGrade < 80){
                            cells[i].innerHTML = "C+";
                        }
                        else if(finalGrade < 83){
                            cells[i].innerHTML = "B-";
                        }
                        else if(finalGrade < 87){
                            cells[i].innerHTML = "B";
                        }
                        else if(finalGrade < 90){
                            cells[i].innerHTML = "B+";
                        }
                        else if(finalGrade < 93){
                            cells[i].innerHTML = "A-";
                        }
                        else if(finalGrade <= 100){
                            cells[i].innerHTML = "A";
                        }
                    }
                    else if(cells[i].id === "gpa_grade"){
                        if(finalGrade < 60){
                            cells[i].innerHTML = "0.0";
                        }
                        else if(finalGrade < 63){
                            cells[i].innerHTML = "0.7";
                        }
                        else if(finalGrade < 67){
                            cells[i].innerHTML = "1.0";
                        }
                        else if(finalGrade < 70){
                            cells[i].innerHTML = "1.3";
                        }
                        else if(finalGrade < 73){
                            cells[i].innerHTML = "1.7";
                        }
                        else if(finalGrade < 77){
                            cells[i].innerHTML = "2.0";
                        }
                        else if(finalGrade < 80){
                            cells[i].innerHTML = "2.3";
                        }
                        else if(finalGrade < 83){
                            cells[i].innerHTML = "2.7";
                        }
                        else if(finalGrade < 87){
                            cells[i].innerHTML = "3.0";
                        }
                        else if(finalGrade < 90){
                            cells[i].innerHTML = "3.3";
                        }
                        else if(finalGrade < 93){
                            cells[i].innerHTML = "3.7";
                        }
                        else if(finalGrade <= 100){
                            cells[i].innerHTML = "4.0";
                        }
                    }
                    
                    if(finalGrade < 60){
                        cells[i].style.color = "white";
                        cells[i].style.backgroundColor = "red";
                    }
                    rowSum = 0;
                }

            }
            //console.log(unsubmitted);
            document.getElementById("unsubmitted").innerHTML = unsubmitted;

        }, 500);

        function addRow(index){
            console.log("AddRow Clicked");
            var table = document.getElementById("grades");
            var averages = document.getElementsByClassName("assignment_average");
            var averageID = averages[0].getAttribute("id");
            columnCount = table.rows[0].cells.length;
            //console.log(index);
            var row = table.insertRow(index);
            
            for(var i = 0; i < columnCount - 1; i++){
                var cell = row.insertCell(i);
                if(i === 0){
                    cell.innerHTML = generateName();
                    cell.classList.add("student_name");
                }
                else if(i === 1){
                    cell.innerHTML = generateStudentNumber();
                }
                else if(i >= 2){
                    cell.innerHTML = "-";
                    cell.classList.add("assignment_grade");
                }
            }
            var cell = row.insertCell(columnCount - 1);
            cell.classList.add("assignment_average");
            cell.id = averageID;
            cell.innerHTML = "0%";

            var table = document.getElementById("grades");
            var rows = table.getElementsByTagName("tr");
            var cells = table.getElementsByTagName("td");

            for(var i = 0; i < rows.length; i++){   //adding event listeners to new cells, I tried putting this loop inside my setInterval() but it kept breaking addRow()
                rows[i].addEventListener("contextmenu", function(event){
                event.preventDefault();
                var contextElement = document.getElementById("context-menu");
                contextElement.style.top = event.pageY + "px";
                contextElement.style.left = event.pageX + "px";
                contextElement.classList.add("active");
                    rowManipulation(this);
                });
                window.addEventListener("click", function(){
                document.getElementById("context-menu").classList.remove("active");
                })
            }
            voidRowEdit();
        }
        function addColumn(){
            var table = document.getElementById("grades");
            var cells = table.getElementsByTagName("td");
            rows = table.getElementsByTagName("tr");
            var cells = table.getElementsByTagName("td");
            var columns = cells.length/(rows.length - 1);
            var numAssigments = columns - 3;
            for(var i = 0; i < rows.length; i++){
                if(i === 0){
                    const cell = document.createElement("th");
                    cell.innerText = "Assignment " + (numAssigments + 1);
                    cell.classList.add("header");
                    rows[i].cells[columns - 2].after(cell);
                }
                else{
                    const cell = document.createElement("td");
                    cell.classList.add("assignment_grade");
                    cell.style.backgroundColor = "inherit";
                    cell.innerHTML = "-";
                    rows[i].cells[columns - 2].after(cell);
                }
            }       
        }
        function rowManipulation(row){      //this add "row_edit" to the classList of each element in the selected row, allowing the insertRowAbove() method to know where to place the new row
            voidRowEdit();
            if(row.classList.contains("row_edit")){
                row.classList.remove("row_edit");
            }
            else{
                row.classList.add("row_edit");
            }
            var cells = row.getElementsByTagName("td");
            //onsole.log(row);
            for(var i = 0; i < cells.length; i++){
                if(cells[i].classList.contains("row_edit")){
                    cells[i].classList.remove("row_edit");
                }
                else{
                    cells[i].classList.add("row_edit");
                }
            }
        }
        function voidRowEdit(){         //voidRow() cleans up the table to prevent the user from adding more than one row to the table at once
            var rows = document.getElementsByClassName("row_edit");
            //console.log(rows);
            for(var i = 0; i < rows.length; i++){
                if(rows[i].classList.contains("row_edit")){
                    rows[i].classList.remove("row_edit");
                }
            }
        }
        function deleteElements(){
            var highlightedElements = document.getElementsByClassName("highlight");
            //console.log(highlightedElements);
            
            while(highlightedElements.length > 0){
                highlightedElements[0].remove();
            }
        }
        function insertRowAbove(offset){  //need to figure out way to remove highlights if selecting new row
            var row = document.getElementsByTagName("tr");
            //console.log(row);
            //console.log(offset);
            //console.log(rows);
            for(var i = 0; i < rows.length; i++){
                if(rows[i].classList.contains("row_edit")){
                    addRow(i + offset);
                    break;
                }
            }
            voidRowEdit();
        }

        function toggleAverage(){       //this allows the user to toggle between different grade representations
            var table = document.getElementById("grades");
            var rows = table.getElementsByTagName("tr");
            var cells = table.getElementsByTagName("td");
            var columns = cells.length/(rows.length - 1);

            for(var i = 0; i < cells.length; i++){
                if(i%columns == columns - 1){
                    if(cells[i].id === "percent_grade"){
                        console.log("id toggling from percent_grade to letter grade");
                        cells[i].id = "letter_grade";
                    }
                    else if(cells[i].id === "letter_grade"){
                        console.log("id toggling from letter_grade to gpa_grade");
                        cells[i].id = "gpa_grade";
                    }
                    else if(cells[i].id === "gpa_grade"){
                        console.log("id toggling from gpa_grapde to percent_grade");
                        cells[i].id = "percent_grade";
                    }
                }
            }
        }

    function generateName(){        //random name generator
        var firstName = ["Michael",
            "Christopher",
            "Jessica",
            "Matthew",
            "Ashley",
            "Jennifer",
            "Joshua",
            "Amanda",
            "Daniel",
            "David",
            "James",
            "Robert",
            "John",
            "Joseph",
            "Andrew",
            "Ryan",
            "Brandon",
            "Jason",
            "Justin",
            "Sarah"];

        var lastName = ["Smith",
            "Johnson",
            "Williams",
            "Jones",
            "Brown",
            "Davis",
            "Miller",
            "Wilson",
            "Moore",
            "Taylor",
            "Anderson",
            "Thomas",
            "Jackson",
            "White",
            "Harris",
            "Martin",
            "Thompson",
            "Garcia",
            "Martinez",
            "Robinson"];

        var name = firstName[Math.floor(Math.random()*(firstName.length))] + " " + lastName[Math.floor(Math.random()*(lastName.length))];
        return name;
    }

    function generateStudentNumber(){
        var number = Math.floor(Math.random()*12345679);
        return number;
    }
    </script>
</body>
</html>