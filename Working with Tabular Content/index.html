<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel = "stylesheet" href = "style.css">
    <title>Grade Sheet</title>
</head>
<body>
    <table id = "grades">
        <tr id = "headers">
            <th>Name</th>
            <th>ID</th>
            <th>Assignment 1</th>
            <th>Assignment 2</th>
            <th>Assignment 3</th>
            <th>Assignment 4</th>
            <th>Assignment 5</th>
            <th style = "cursor: pointer" onclick = "toggleAverage()">Average(%)</th>
        </tr>
        <tr>
            <td>Tianna Wall</div></td>
            <td>12345670</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_grade">0</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td>Anika Campos</div></td>
            <td>12345671</td>
            <td class = "assignment_grade">34</td>
            <td class = "assignment_grade">56</td>
            <td class = "assignment_grade">87</td>
            <td class = "assignment_grade">45</td>
            <td class = "assignment_grade">90</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td>Madalynn Bray</div></td>
            <td>12345672</td>
            <td class = "assignment_grade">23</td>
            <td class = "assignment_grade">56</td>
            <td class = "assignment_grade">76</td>
            <td class = "assignment_grade">87</td>
            <td class = "assignment_grade">32</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td>Rylee Nixon</div></td>
            <td>12345673</td>
            <td class = "assignment_grade">62</td>
            <td class = "assignment_grade">-</td>
            <td class = "assignment_grade">67</td>
            <td class = "assignment_grade">98</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td>Rowan Dawson</div></td>
            <td>12345674</td>
            <td class = "assignment_grade">76</td>
            <td class = "assignment_grade">54</td>
            <td class = "assignment_grade">23</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_grade">23</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td>Emma Smith</div></td>
            <td>12345675</td>
            <td class = "assignment_grade">98</td>
            <td class = "assignment_grade">100</td>
            <td class = "assignment_grade">78</td>
            <td class = "assignment_grade">76</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td>Julianne Boyer</div></td>
            <td>12345676</td>
            <td class = "assignment_grade">56</td>
            <td class = "assignment_grade">81</td>
            <td class = "assignment_grade">95</td>
            <td class = "assignment_grade">78</td>
            <td class = "assignment_grade">67</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td>David Harmon</div></td>
            <td>12345677</td>
            <td class = "assignment_grade">87</td>
            <td class = "assignment_grade">87</td>
            <td class = "assignment_grade">56</td>
            <td class = "assignment_grade">100</td>
            <td class = "assignment_grade">87</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td>Micheal Kerr</div></td>
            <td>12345678</td>
            <td class = "assignment_grade">76</td>
            <td class = "assignment_grade">98</td>
            <td class = "assignment_grade">78</td>
            <td class = "assignment_grade">78</td>
            <td class = "assignment_grade">70</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
        <tr>
            <td>Aiden Calvin</div></td>
            <td>12345679</td>
            <td class = "assignment_grade">67</td>
            <td class = "assignment_grade">67</td>
            <td class = "assignment_grade">65</td>
            <td class = "assignment_grade">98</td>
            <td class = "assignment_grade">98</td>
            <td class = "assignment_average" id = "percent_grade">%</td>
        </tr>
    </table>
    <p></p>
    <button onclick = "addRow()">Add Row</button>
    <button onclick = "addColumn()">Add Column</button>
    <p></p>
    <div class = "table_info">
        <div style = "float: left">Unsubmitted Assignments:</div>
        <div id = "unsubmitted" style = "float: right"></div>
    </div>

    <script>
        setInterval(function() {
            var table = document.getElementById("grades");
            var rows = table.getElementsByTagName("tr");
            var cells = table.getElementsByTagName("td");
            var columns = cells.length/(rows.length - 1);
            var rowSum = 0;
            var unsubmitted = 0;
            for(var i = 0; i < cells.length; i++){
                if(i%columns > 1 && i%columns < columns - 1){          //Don't want the Name, ID or Average Cells to be editable              
                    if(cells[i].innerHTML === "-"){
                        unsubmitted++;
                        cells[i].style.backgroundColor = "yellow";
                    }
                    else{
                        cells[i].style.backgroundColor = "inherit";
                    }
                    cells[i].onclick = function(){
                        if(this.hasAttribute("data-clicked")){
                            return;
                        }
                    this.setAttribute("data-clicked", "yes");
                    this.setAttribute("data-text", this.innerHTML);

                    var input = document.createElement("input");
                    input.setAttribute("type", "text");
                    input.value = this.innerHTML;
                    input.style.width = this.offsetWidth - (this.clientLeft * 2) + "px";
                    input.style.height = this.offsetHeight - (this.clientTop * 2) + "px";
                    input.style.border = "0px";
                    input.style.fontFamily = "inherit";
                    input.style.fontSize = "inherit";
                    input.style.textAlign = "inherit";
                    input.style.backgroundColor = "LightGoldenRodYellow";

                    input.onblur = function(){
                        var td = input.parentElement;
                        var originalText = input.parentElement.getAttribute("data-text");
                        var currentText = this.value;

                        if(!Number.isInteger(parseInt(currentText))){
                            currentText = "-";
                        }

                        if(originalText != currentText){
                            //there are changes in the cell's text
                            td.removeAttribute("data-clicked");
                            td.removeAttribute("data-text");
                            td.innerHTML = currentText;
                            td.style.cssText = "padding 5px";
                            //console.log(originalText + " is changed to " + currentText);
                        }
                        else{
                            td.removeAttribute("data-clicked");
                            td.removeAttribute("data-text");
                            td.innerHTML = originalText;
                            td.style.cssText = "padding 5px";
                            //console.log("No changes made");
                        }
                    }

                    input.onkeypress = function(){
                        if(event.keyCode == 13){
                            this.blur();
                        }
                    }

                    this.innerHTML = "";
                    this.style.cssText = "padding: 0px 0px";
                    this.append(input);
                    this.firstElementChild.select();
                    }
                    var value = cells[i].innerHTML;
                    if(Number.isInteger(parseInt(value))){
                        if(value < 0 || value > 100){
                            cells[i].innerHTML = "-";
                        }
                        else{
                            rowSum += parseInt(value);
                        }
                    }
                }
                else if(i%columns == columns - 1){
                    if(rowSum == 0){
                        cells[i].innerHTML = 0;
                    }
                    var finalGrade = parseInt(rowSum/(columns - 3));

                    if(cells[i].id === "percent_grade"){
                        cells[i].innerHTML = finalGrade + "%";
                    }
                    else if(cells[i].id === "letter_grade"){
                        if(finalGrade < 60){
                            cells[i].innerHTML = "F";
                        }
                        else if(finalGrade < 63){
                            cells[i].innerHTML = "D-";
                        }
                        else if(finalGrade < 67){
                            cells[i].innerHTML = "D";
                        }
                        else if(finalGrade < 70){
                            cells[i].innerHTML = "D+";
                        }
                        else if(finalGrade < 73){
                            cells[i].innerHTML = "C-";
                        }
                        else if(finalGrade < 77){
                            cells[i].innerHTML = "C";
                        }
                        else if(finalGrade < 80){
                            cells[i].innerHTML = "C+";
                        }
                        else if(finalGrade < 83){
                            cells[i].innerHTML = "B-";
                        }
                        else if(finalGrade < 87){
                            cells[i].innerHTML = "B";
                        }
                        else if(finalGrade < 90){
                            cells[i].innerHTML = "B+";
                        }
                        else if(finalGrade < 93){
                            cells[i].innerHTML = "A-";
                        }
                        else if(finalGrade <= 100){
                            cells[i].innerHTML = "A";
                        }
                    }
                    else if(cells[i].id === "gpa_grade"){
                        if(finalGrade < 60){
                            cells[i].innerHTML = "0.0";
                        }
                        else if(finalGrade < 63){
                            cells[i].innerHTML = "0.7";
                        }
                        else if(finalGrade < 67){
                            cells[i].innerHTML = "1.0";
                        }
                        else if(finalGrade < 70){
                            cells[i].innerHTML = "1.3";
                        }
                        else if(finalGrade < 73){
                            cells[i].innerHTML = "1.7";
                        }
                        else if(finalGrade < 77){
                            cells[i].innerHTML = "2.0";
                        }
                        else if(finalGrade < 80){
                            cells[i].innerHTML = "2.3";
                        }
                        else if(finalGrade < 83){
                            cells[i].innerHTML = "2.7";
                        }
                        else if(finalGrade < 87){
                            cells[i].innerHTML = "3.0";
                        }
                        else if(finalGrade < 90){
                            cells[i].innerHTML = "3.3";
                        }
                        else if(finalGrade < 93){
                            cells[i].innerHTML = "3.7";
                        }
                        else if(finalGrade <= 100){
                            cells[i].innerHTML = "4.0";
                        }
                    }
                    
                    if(finalGrade < 60){
                        cells[i].style.color = "white";
                        cells[i].style.backgroundColor = "red";
                    }
                    else{
                        cells[i].style.color = "black";
                        cells[i].style.backgroundColor = "white";
                    }
                    rowSum = 0;
                }

            }
            //console.log(unsubmitted);
            document.getElementById("unsubmitted").innerHTML = unsubmitted;

        }, 1000);

        function addRow(){
            var table = document.getElementById("grades");
            columnCount = table.rows[0].cells.length;
            var row = table.insertRow(-1);
            
            for(var i = 0; i < columnCount - 1; i++){
                var cell = row.insertCell(i);
                if(i >= 2){
                    cell.innerHTML = "-";
                    cell.classList.add("assignment_grade");
                }
            }
            var cell = row.insertCell(columnCount - 1);
            cell.classList.add("assignment_average");
            cell.innerHTML = "0%";
        }
        function addColumn(){
            var table = document.getElementById("grades");
            var cells = table.getElementsByTagName("td");
            rows = table.getElementsByTagName("tr");
            var cells = table.getElementsByTagName("td");
            var columns = cells.length/(rows.length - 1);
            var numAssigments = columns - 3;
            for(var i = 0; i < rows.length; i++){
                if(i === 0){
                    const cell = document.createElement("th");
                    cell.innerText = "Assignment " + (numAssigments + 1);
                    rows[i].cells[columns - 2].after(cell);
                }
                else{
                    const cell = document.createElement("td");
                    cell.classList.add("assignment_grade");
                    cell.style.backgroundColor = "inherit";
                    cell.innerHTML = "-";
                    rows[i].cells[columns - 2].after(cell);
                }
            }

            
        }

        function toggleAverage(){
            var table = document.getElementById("grades");
            var rows = table.getElementsByTagName("tr");
            var cells = table.getElementsByTagName("td");
            var columns = cells.length/(rows.length - 1);

            for(var i = 0; i < cells.length; i++){
                if(i%columns == columns - 1){
                    if(cells[i].id === "percent_grade"){
                        console.log("id toggling from percent_grade to letter grade");
                        cells[i].id = "letter_grade";
                    }
                    else if(cells[i].id === "letter_grade"){
                        console.log("id toggling from letter_grade to gpa_grade");
                        cells[i].id = "gpa_grade";
                    }
                    else if(cells[i].id === "gpa_grade"){
                        console.log("id toggling from gpa_grapde to percent_grade");
                        cells[i].id = "percent_grade";
                    }
                }
            }
        }


    </script>
</body>
</html>